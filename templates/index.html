<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Instagram Mass DM Tool</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
            <h1 class="text-2xl font-bold mb-6 text-center">Instagram Mass DM Tool</h1>
            
            <form method="POST" class="space-y-4" id="dmForm">
                <div>
                    <label for="username" class="block text-sm font-medium text-gray-700">Target Username</label>
                    <input type="text" name="username" id="username" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>

                <div>
                    <label for="message" class="block text-sm font-medium text-gray-700">Message</label>
                    <textarea name="message" id="message" rows="3" required
                              class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500"></textarea>
                </div>

                <div>
                    <label for="delay_between_msgs" class="block text-sm font-medium text-gray-700">Delay Between Messages (seconds)</label>
                    <input type="number" name="delay_between_msgs" id="delay_between_msgs" min="30" value="45" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>

                <div>
                    <label for="max_accounts" class="block text-sm font-medium text-gray-700">Maximum Number of Accounts</label>
                    <input type="number" name="max_accounts" id="max_accounts" min="1" max="100" value="50" required
                           class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>

                <button type="submit" id="submitBtn"
                        class="w-full bg-indigo-600 text-white py-2 px-4 rounded-md hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2">
                    Start Process
                </button>
            </form>

            <div id="status" class="mt-6 hidden">
                <h2 class="text-lg font-semibold mb-2">Status Updates</h2>
                <div id="updates" class="bg-gray-50 p-4 rounded-md h-64 overflow-y-auto space-y-2">
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const socket = io();
            const updates = document.getElementById('updates');
            const status = document.getElementById('status');
            const form = document.getElementById('dmForm');
            const submitBtn = document.getElementById('submitBtn');

            socket.on('connect', function() {
                console.log('Connected to server');
            });

            socket.on('disconnect', function() {
                console.log('Disconnected from server');
                addUpdate('Disconnected from server. Please refresh the page.', 'error');
            });

            socket.on('update', function(message) {
                addUpdate(message);
            });

            form.addEventListener('submit', function() {
                status.classList.remove('hidden');
                submitBtn.disabled = true;
                submitBtn.textContent = 'Processing...';
                updates.innerHTML = '';
                addUpdate('Starting process...');
            });

            function addUpdate(message, type = 'info') {
                const div = document.createElement('div');
                div.className = `text-sm ${type === 'error' ? 'text-red-600' : 'text-gray-700'}`;
                div.textContent = message;
                updates.appendChild(div);
                updates.scrollTop = updates.scrollHeight;
            }

            // Reconnection handling
            socket.on('connect_error', function() {
                addUpdate('Connection error. Attempting to reconnect...', 'error');
            });

            socket.on('reconnect', function(attemptNumber) {
                addUpdate(`Reconnected after ${attemptNumber} attempts.`);
            });

            socket.on('reconnect_error', function() {
                addUpdate('Failed to reconnect. Please refresh the page.', 'error');
            });
        });
    </script>
</body>
</html>
